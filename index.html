<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Entry with Barcode</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ffffff" />
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.mini.min.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    input, button { margin: 0.5rem 0; display: block; width: 100%; padding: 0.5rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    canvas { margin-top: 1rem; }
  </style>
</head>
<body>
  <h2>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
  <form id="dataForm">
    <input type="text" id="lot" placeholder="LOT" required />
    <input type="date" id="delivery" placeholder="Delivery Date" required />
    <input type="text" id="po" placeholder="PO" required />
    <input type="date" id="production" placeholder="Production Date" required />
    <button type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </form>

  <button onclick="downloadExcel()">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel</button>
  <button onclick="downloadCSV()">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</button>

  <table id="dataTable">
    <thead>
      <tr><th>LOT</th><th>Delivery Date</th><th>PO</th><th>Production Date</th><th>Barcode</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const data = [];

    document.getElementById('dataForm').addEventListener('submit', e => {
      e.preventDefault();
      const lot = document.getElementById('lot').value;
      const delivery = document.getElementById('delivery').value;
      const po = document.getElementById('po').value;
      const production = document.getElementById('production').value;
      const barcodeSvg = `<svg id='bc-${data.length}'></svg>`;

      data.push({ lot, delivery, po, production });
      const row = document.createElement('tr');
      row.innerHTML = `<td>${lot}</td><td>${delivery}</td><td>${po}</td><td>${production}</td><td>${barcodeSvg}</td>`;
      document.querySelector('#dataTable tbody').appendChild(row);

      JsBarcode(`#bc-${data.length - 1}`, lot, { format: 'CODE128', width: 2, height: 40 });

      document.getElementById('dataForm').reset();
    });

    function downloadExcel() {
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
      XLSX.writeFile(wb, 'data.xlsx');
    }

    function downloadCSV() {
      const csv = ["LOT,Delivery Date,PO,Production Date"];
      data.forEach(d => {
        csv.push(`${d.lot},${d.delivery},${d.po},${d.production}`);
      });
      const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'data.csv';
      link.click();
    }
  </script>
</body>
</html>
